name: 2. Types on Workflow Run

# Este workflow demonstra o uso do filtro `types` no gatilho `workflow_run`.
# O filtro `types` permite que voc√™ execute jobs em diferentes est√°gios do ciclo de vida
# de um outro workflow, e n√£o apenas quando ele termina.
#
# Casos de uso comuns:
# - Enviar uma notifica√ß√£o para o Slack quando um deploy √© INICIADO (`requested`).
# - Enviar uma segunda notifica√ß√£o com o resultado (sucesso/falha) quando o deploy √© CONCLU√çDO (`completed`).
# - Registrar logs ou m√©tricas em diferentes pontos da execu√ß√£o de um pipeline cr√≠tico.
on:
  workflow_run:
    # O nome do workflow que acionar√° este.
    # IMPORTANTE: Substitua pelo nome exato do seu workflow de CI.
    workflows: ["Meu Primeiro Workflow de CI"]

    # A chave 'types' especifica os eventos do ciclo de vida do workflow alvo que acionar√£o este.
    # Se esta chave n√£o for usada, o GitHub Actions usa o valor padr√£o: ['completed'].
    # Ao especificar os tipos, voc√™ ganha um controle mais granular.
    types:
      - requested  # Aciona no momento em que o workflow alvo √© enfileirado para execu√ß√£o.
      - completed  # Aciona quando o workflow alvo termina (seja com sucesso, falha, cancelado, etc.).

jobs:
  # Este job √© projetado para rodar quando o workflow alvo √© SOLICITADO.
  on-requested:
    runs-on: ubuntu-latest
    # A condi√ß√£o `if` √© crucial aqui. Ela verifica o campo `action` do evento `workflow_run`.
    # O valor de `github.event.action` corresponder√° ao `type` que acionou a execu√ß√£o.
    # Neste caso, o job s√≥ executa se o evento foi 'requested'.
    if: ${{ github.event.action == 'requested' }}
    steps:
      - name: A√ß√£o quando o workflow √© solicitado
        run: echo "üîî O workflow '${{ github.event.workflow_run.workflow.name }}' foi solicitado e est√° prestes a come√ßar."

  # Este job √© projetado para rodar quando o workflow alvo √© CONCLU√çDO.
  on-completed:
    runs-on: ubuntu-latest
    # Da mesma forma, este job s√≥ executa se o evento que o acionou foi 'completed'.
    if: ${{ github.event.action == 'completed' }}
    steps:
      - name: A√ß√£o quando o workflow √© conclu√≠do
        run: |
          echo "üèÅ O workflow '${{ github.event.workflow_run.workflow.name }}' foi conclu√≠do."
          # Quando a a√ß√£o √© 'completed', podemos acessar o resultado final do workflow alvo
          # atrav√©s de `github.event.workflow_run.conclusion`.
          echo "Resultado final: ${{ github.event.workflow_run.conclusion }}"