name: 03 - Teste Aula

on:
  push:
    branches: [ aula-teste ]
  workflow_dispatch:

env:
  NOME_BRANCH: "aula-teste"
  AMBIENTE: "teste"
  VERSAO: "0.1.0"
  DATA_TESTE: ${{ github.event.head_commit.timestamp || '' }}

jobs:
  teste-aula:
    runs-on: ubuntu-latest
    
    env:
      JOB_ID: "teste-aula-001"
      TIMESTAMP: ${{ github.event.head_commit.timestamp || '' }}
    
    steps:
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v4
        
      - name: Exibir informaÃ§Ãµes da branch
        run: |
          echo "ðŸŽ¯ === INFORMAÃ‡Ã•ES DA BRANCH ==="
          echo "Branch atual: ${{ github.ref_name }}"
          echo "RepositÃ³rio: ${{ github.repository }}"
          echo "UsuÃ¡rio: ${{ github.actor }}"
          echo "Evento: ${{ github.event_name }}"
          echo "Workflow: ${{ github.workflow }}"
          echo "Run ID: ${{ github.run_id }}"
          
      - name: Exibir variÃ¡veis de ambiente
        run: |
          echo "ðŸ”§ === VARIÃVEIS DE AMBIENTE ==="
          echo "Nome da Branch: ${{ env.NOME_BRANCH }}"
          echo "Ambiente: ${{ env.AMBIENTE }}"
          echo "VersÃ£o: ${{ env.VERSAO }}"
          echo "Data do Teste: ${{ env.DATA_TESTE }}"
          echo "Job ID: ${{ env.JOB_ID }}"
          echo "Timestamp: ${{ env.TIMESTAMP }}"
          
      - name: Criar arquivo de teste
        run: |
          echo "ðŸ“ === CRIANDO ARQUIVO DE TESTE ==="
          cat > teste-aula.txt << EOF
          ========================================
          ARQUIVO DE TESTE - BRANCH AULA-TESTE
          ========================================
          
          InformaÃ§Ãµes do Teste:
          - Branch: ${{ github.ref_name }}
          - RepositÃ³rio: ${{ github.repository }}
          - UsuÃ¡rio: ${{ github.actor }}
          - Data: ${{ env.DATA_TESTE }}
          - Commit: ${{ github.sha }}
          - Workflow: ${{ github.workflow }}
          - Job ID: ${{ env.JOB_ID }}
          
          VariÃ¡veis de Ambiente:
          - NOME_BRANCH: ${{ env.NOME_BRANCH }}
          - AMBIENTE: ${{ env.AMBIENTE }}
          - VERSAO: ${{ env.VERSAO }}
          
          Status: âœ… Teste executado com sucesso!
          ========================================
          EOF
          
          echo "Arquivo criado:"
          cat teste-aula.txt
          
      - name: Listar arquivos do repositÃ³rio
        run: |
          echo "ðŸ“ === ARQUIVOS DO REPOSITÃ“RIO ==="
          ls -la
          echo ""
          echo "ðŸ“‚ ConteÃºdo do diretÃ³rio .github/workflows:"
          ls -la .github/workflows/
          
      - name: Teste de variÃ¡veis condicionais
        run: |
          echo "ðŸŽ² === TESTE DE VARIÃVEIS CONDICIONAIS ==="
          
          # Teste baseado na branch
          if [ "${{ github.ref_name }}" = "aula-teste" ]; then
            echo "âœ… Executando na branch correta: aula-teste"
          else
            echo "âŒ Executando em branch incorreta: ${{ github.ref_name }}"
          fi
          
          # Teste baseado no evento
          if [ "${{ github.event_name }}" = "push" ]; then
            echo "âœ… Evento: push"
          elif [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "âœ… Evento: workflow_dispatch (manual)"
          else
            echo "â“ Evento: ${{ github.event_name }}"
          fi
          
      - name: Criar relatÃ³rio final
        run: |
          echo "ðŸ“Š === RELATÃ“RIO FINAL ==="
          cat > relatorio-teste.json << EOF
          {
            "branch": "${{ github.ref_name }}",
            "repositorio": "${{ github.repository }}",
            "usuario": "${{ github.actor }}",
            "evento": "${{ github.event_name }}",
            "workflow": "${{ github.workflow }}",
            "run_id": "${{ github.run_id }}",
            "commit": "${{ github.sha }}",
            "data_teste": "${{ env.DATA_TESTE }}",
            "ambiente": "${{ env.AMBIENTE }}",
            "versao": "${{ env.VERSAO }}",
            "status": "sucesso",
            "arquivos_criados": [
              "teste-aula.txt",
              "relatorio-teste.json"
            ]
          }
          EOF
          
          echo "RelatÃ³rio criado:"
          cat relatorio-teste.json
          
      - name: Upload arquivos de teste
        uses: actions/upload-artifact@v4
        with:
          name: arquivos-teste-aula
          path: |
            teste-aula.txt
            relatorio-teste.json
          
      - name: Mensagem de sucesso
        run: |
          echo "ðŸŽ‰ === TESTE CONCLUÃDO COM SUCESSO! ==="
          echo "âœ… Branch: ${{ github.ref_name }}"
          echo "âœ… Workflow: ${{ github.workflow }}"
          echo "âœ… UsuÃ¡rio: ${{ github.actor }}"
          echo "âœ… Data: ${{ env.DATA_TESTE }}"
          echo ""
          echo "ðŸ“ Arquivos criados:"
          echo "   - teste-aula.txt"
          echo "   - relatorio-teste.json"
          echo ""
          echo "ðŸš€ PrÃ³ximo passo: Verificar os artifacts no GitHub!"
